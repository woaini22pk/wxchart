"use strict";!function(t){function i(t){this.defaultColors=["#D53A35","#2F4554","#6AB0B8","#D48265","#91C7AE","#6E7074","#C4CCD3"],this.options=t}function o(t,i){t||console.error("chart.js:Assert false:"+i)}function s(t,i){for(var o in i)t[o]=i[o];return t}i.prototype._beforeDraw=function(){var t=this.options;t.x?t.x:t.x=0,t.y?t.y:t.y=0,o(t.id,"id属性不能为空"),o(t.data,"data属性不能为空"),this.ctx=wx.createCanvasContext(t.id)},i.prototype._afterDraw=function(){this.ctx.draw()},i.prototype._initPie=function(){o(this.options.r,"半径r不能为空"),this.angle=0,this.at=0,this.pointerAt=0;var t=this.options.data,i=t.reduce(function(t,i){return t+=i.value},0),s=t.map(function(t){return t.rate=t.value/i,t});this.data=s},i.prototype.drawPie=function(t){var i=this;s(this.options,t),this._beforeDraw(),this._initPie();var o=this.options,n=0;this.data.forEach(function(t){i.ctx.beginPath(),i.ctx.moveTo(o.x,o.y);var s=i.angle+2*t.rate;i.ctx.arc(o.x,o.y,o.r,i.angle*Math.PI,s*Math.PI),n>i.defaultColors.length-1&&(n=0);var e=null;e=t.color?t.color:i.defaultColors[n++],i.ctx.setFillStyle(e),i.ctx.closePath(),i.ctx.fill(),i.pointerAt=i.at+180*t.rate,i.at+=360*t.rate,i.angle=s,i.ctx.beginPath(),i.ctx.moveTo(i.options.x,i.options.y);var r=i.options.x+(i.options.r+30)*Math.cos(i.pointerAt*Math.PI/180),h=i.options.y+(i.options.r+30)*Math.sin(i.pointerAt*Math.PI/180);i.ctx.lineTo(r,h);var x=null;i.pointerAt<=90||i.pointerAt>=270?(x="left",r+=10):(x="right",r-=10),i.ctx.lineTo(r,h),i.ctx.setStrokeStyle(e),i.ctx.stroke(),i.ctx.setFontSize(t.font?t.font:12),i.ctx.setTextBaseline("middle"),i.ctx.setTextAlign(x),i.ctx.fillText(t.name,r,h)}),this._afterDraw()},i.prototype._initXY=function(){var t=this;o(this.options.size,"size属性不能为空"),o(this.options.xAxis,"x轴定义不能为空"),o(this.options.yAxis,"y轴定义不能为空"),o(this.options.yAxis.cursors,"y轴指标数量不能为空"),this.options.xAxis.maxWidth=30,this.options.xAxis.cursorStep=Math.floor(this.options.size.width/this.options.xAxis.data.length);var i=this.options.data.slice();i.sort(function(t,i){return i.value-t.value});var s=i[0].value;this.options.yAxis.cursorStep=Math.floor(this.options.size.height/this.options.yAxis.cursors),this.options.yAxis.precise=Math.ceil(s/this.options.yAxis.cursors),this.ctx.moveTo(this.options.x,this.options.y),this.ctx.lineTo(this.options.x+this.options.size.width,this.options.y),this.ctx.stroke(),this.options.xAxis.start=this.options.xAxis.cursorStep/2,this.xpoints=new Array,this.options.xAxis.data.forEach(function(i){t.xpoints.push(t.options.x+t.options.xAxis.start),t.ctx.moveTo(t.options.x+t.options.xAxis.start,t.options.y),t.ctx.lineTo(t.options.x+t.options.xAxis.start,t.options.y+5),t.ctx.stroke(),t.ctx.setTextAlign("center"),t.ctx.setTextBaseline("bottom"),t.ctx.setFontSize(t.options.font),t.ctx.fillText(i,t.options.x+t.options.xAxis.start,t.options.y+15),t.options.xAxis.start+=t.options.xAxis.cursorStep}),this.ctx.moveTo(this.options.x,this.options.y),this.ctx.lineTo(this.options.x,this.options.y-this.options.size.height),this.ctx.stroke();for(var n=1;n<=this.options.yAxis.cursors;n++)this.ctx.moveTo(this.options.x,this.options.y-this.options.yAxis.cursorStep*n),this.ctx.lineTo(this.options.x-5,this.options.y-this.options.yAxis.cursorStep*n),this.ctx.stroke(),this.ctx.setTextAlign("left"),this.ctx.setTextBaseline("center"),this.ctx.setFontSize(this.options.font),this.ctx.fillText(this.options.yAxis.precise*n,this.options.x-35,this.options.y-this.options.yAxis.cursorStep*n)},i.prototype.drawBar=function(t){s(this.options,t),this._beforeDraw(),this._initXY(),console.log(this.xpoints);var i=this.options.xAxis.cursorStep/2;i>this.options.xAxis.maxWidth&&(i=this.options.xAxis.maxWidth);for(var o=0;o<this.xpoints.length;o++){var n=this.xpoints[o];this.ctx.moveTo(n+i/2,this.options.y);var e=this.options.data[o].value*this.options.size.height/(this.options.yAxis.precise*this.options.yAxis.cursors);this.ctx.lineTo(n+i/2,this.options.y-e),this.ctx.lineTo(n-i/2,this.options.y-e),this.ctx.lineTo(n-i/2,this.options.y),this.ctx.setFillStyle("#3398DB"),this.ctx.fill()}this._afterDraw()},i.prototype.drawScatter=function(t){s(this.options,t),this._beforeDraw(),this._initXY();var i=this.options.data;this._scatter(i);for(var o=1;o<10;o++)this._scatter(this.options["data"+o]);this._afterDraw()},i.prototype._scatter=function(t){var i=this;if(t){var o=this.options.xAxis.data[this.options.xAxis.data.length-1];t.forEach(function(t){var s=t.name*i.options.size.width/o,n=t.value*i.options.size.height/(i.options.yAxis.precise*i.options.yAxis.cursors);i.ctx.moveTo(i.options.x+s,i.options.y-n),i.ctx.arc(i.options.x+s,i.options.y-n,2,0,2*Math.PI),i.ctx.fill()})}},t.exports=i}(module);