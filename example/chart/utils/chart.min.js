"use strict";!function(t){function i(t){this.defaultColors=["#D53A35","#2F4554","#6AB0B8","#D48265","#91C7AE","#6E7074","#C4CCD3"],this.options=t}function s(t,i){t||console.error("chart.js:Assert false:"+i)}function o(t,i){for(var s in i)t[s]=i[s];return t}i.prototype._initPie=function(){s(this.options.r,"半径r不能为空"),this.angle=0,this.at=0,this.pointerAt=0},i.prototype.drawPie=function(t){var i=this;o(this.options,t),this._beforeDraw(),this._initPie();var s=this.options,n=0;this.data.forEach(function(t){i.ctx.beginPath(),i.ctx.moveTo(s.x,s.y);var o=i.angle+2*t.rate;i.ctx.arc(s.x,s.y,s.r,i.angle*Math.PI,o*Math.PI),n>i.defaultColors.length-1&&(n=0);var e=null;e=t.color?t.color:i.defaultColors[n++],i.ctx.setFillStyle(e),i.ctx.closePath(),i.ctx.fill(),i.pointerAt=i.at+180*t.rate,i.at+=360*t.rate,i.angle=o,i.ctx.beginPath(),i.ctx.moveTo(i.options.x,i.options.y);var r=i.options.x+(i.options.r+30)*Math.cos(i.pointerAt*Math.PI/180),x=i.options.y+(i.options.r+30)*Math.sin(i.pointerAt*Math.PI/180);i.ctx.lineTo(r,x);var h=null;i.pointerAt<=90||i.pointerAt>=270?(h="left",r+=10):(h="right",r-=10),i.ctx.lineTo(r,x),i.ctx.setStrokeStyle(e),i.ctx.stroke(),i.ctx.setFontSize(t.font?t.font:12),i.ctx.setTextBaseline("middle"),i.ctx.setTextAlign(h),i.ctx.fillText(t.name,r,x)}),this._afterDraw()},i.prototype._initBar=function(){s(this.options.size,"size属性不能为空"),s(this.options.xAxis,"x轴定义不能为空"),s(this.options.yAxis,"y轴定义不能为空"),s(this.options.yAxis.cursors,"y轴指标数量不能为空"),this.options.xAxis.maxWidth=30,this.options.xAxis.cursorStep=Math.floor(this.options.size.width/this.options.xAxis.data.length);var t=this.options.data.slice();t.sort(function(t,i){return i.value-t.value});var i=t[0].value;this.options.yAxis.cursorStep=Math.floor(this.options.size.height/this.options.yAxis.cursors),this.options.yAxis.precise=Math.ceil(i/this.options.yAxis.cursors)},i.prototype.drawBar=function(t){var i=this;o(this.options,t),this._beforeDraw(),this._initBar(),this.ctx.moveTo(this.options.x,this.options.y),this.ctx.lineTo(this.options.x+this.options.size.width,this.options.y),this.ctx.stroke(),this.options.xAxis.start=this.options.xAxis.cursorStep/2,this.xpoints=new Array,this.options.xAxis.data.forEach(function(t){i.xpoints.push(i.options.x+i.options.xAxis.start),i.ctx.moveTo(i.options.x+i.options.xAxis.start,i.options.y),i.ctx.lineTo(i.options.x+i.options.xAxis.start,i.options.y+5),i.ctx.stroke(),i.ctx.setTextAlign("center"),i.ctx.setTextBaseline("bottom"),i.ctx.setFontSize(i.options.font),i.ctx.fillText(t,i.options.x+i.options.xAxis.start,i.options.y+15),i.options.xAxis.start+=i.options.xAxis.cursorStep}),this.ctx.moveTo(this.options.x,this.options.y),this.ctx.lineTo(this.options.x,this.options.y-this.options.size.height),this.ctx.stroke();for(var s=1;s<=this.options.yAxis.cursors;s++)this.ctx.moveTo(this.options.x,this.options.y-this.options.yAxis.cursorStep*s),this.ctx.lineTo(this.options.x-5,this.options.y-this.options.yAxis.cursorStep*s),this.ctx.stroke(),this.ctx.setTextAlign("left"),this.ctx.setTextBaseline("center"),this.ctx.setFontSize(this.options.font),this.ctx.fillText(this.options.yAxis.precise*s,this.options.x-35,this.options.y-this.options.yAxis.cursorStep*s);console.log(this.xpoints);var n=this.options.xAxis.cursorStep/2;n>this.options.xAxis.maxWidth&&(n=this.options.xAxis.maxWidth);for(s=0;s<this.xpoints.length;s++){var e=this.xpoints[s];this.ctx.moveTo(e+n/2,this.options.y);var r=this.options.data[s].value*this.options.size.height/(this.options.yAxis.precise*this.options.yAxis.cursors);this.ctx.lineTo(e+n/2,this.options.y-r),this.ctx.lineTo(e-n/2,this.options.y-r),this.ctx.lineTo(e-n/2,this.options.y),this.ctx.setFillStyle("#3398DB"),this.ctx.fill()}this._afterDraw()},i.prototype._beforeDraw=function(){var t=this.options;t.x?t.x:t.x=0,t.y?t.y:t.y=0,s(t.id,"id属性不能为空"),s(t.data,"data属性不能为空"),this.ctx=wx.createCanvasContext(t.id);var i=t.data,o=i.reduce(function(t,i){return t+=i.value},0),n=i.map(function(t){return t.rate=t.value/o,t});this.data=n},i.prototype._afterDraw=function(){this.ctx.draw()},t.exports=i}(module);